<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OpenLayers 지도 컨트롤</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    #toolbar {
      background: #2c3e50;
      padding: 15px;
      display: flex;
      gap: 10px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    button {
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      background: #34495e;
      color: white;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s ease;
    }

    button:hover {
      background: #415b76;
      transform: translateY(-2px);
    }

    button.active {
      background: #3498db;
    }

    button#clearBtn {
      background: #e74c3c;
      margin-left: auto;
    }

    button#clearBtn:hover {
      background: #c0392b;
    }

    #map {
      flex: 1;
      width: 100%;
    }

    #map.edit-mode {
      cursor: url('/edit-cursor2.cur') 16 16, auto;
    }

    .separator {
      width: 2px;
      background: #1a252f;
      height: 40px;
      align-self: center;
    }

    .panel {
      position: absolute;
      top: 80px;
      right: 20px;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      min-width: 340px;
      max-width: 450px;
      z-index: 1000;
      max-height: calc(100vh - 100px);
      overflow-y: auto;
    }

    .panel.hidden {
      display: none;
    }

    .panel h3 {
      margin-bottom: 20px;
      color: #2c3e50;
      font-size: 18px;
      border-bottom: 2px solid #3498db;
      padding-bottom: 10px;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
      color: #2c3e50;
      font-size: 14px;
    }

    .form-group input[type="file"] {
      width: 100%;
      padding: 8px;
      border: 2px dashed #3498db;
      border-radius: 4px;
      background: #ecf0f1;
      cursor: pointer;
      font-size: 13px;
    }

    .coords-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }

    .coords-grid input {
      padding: 8px;
      border: 1px solid #bdc3c7;
      border-radius: 4px;
      font-size: 13px;
    }

    .coords-grid input:focus {
      outline: none;
      border-color: #3498db;
    }

    input[type="range"] {
      width: 100%;
      cursor: pointer;
    }

    .button-group {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }

    .button-group button {
      flex: 1;
    }

    button.primary {
      background: #27ae60;
    }

    button.primary:hover {
      background: #229954;
    }

    button.danger {
      background: #e74c3c;
    }

    button.danger:hover {
      background: #c0392b;
    }

    button.secondary {
      background: #3498db;
      width: 100%;
      margin-bottom: 10px;
    }

    button.secondary:hover {
      background: #2980b9;
    }

    .instructions {
      display: block;
      font-size: 12px;
      color: #e67e22;
      margin-bottom: 10px;
      font-weight: 500;
      text-align: center;
    }

    .instructions.hidden {
      display: none;
    }

    #map.coordinate-picking {
      cursor: crosshair !important;
    }

    /* ===== 탭 시스템 ===== */
    .mode-tabs {
      display: flex;
      gap: 0;
      margin-bottom: 15px;
      border-bottom: 2px solid #ecf0f1;
    }

    .mode-tabs button {
      flex: 1;
      padding: 8px 12px;
      border: none;
      border-radius: 5px 5px 0 0;
      background: #ecf0f1;
      color: #7f8c8d;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      transition: all 0.2s ease;
    }

    .mode-tabs button:hover {
      background: #d5dbdb;
      transform: none;
    }

    .mode-tabs button.active {
      background: #3498db;
      color: white;
    }

    .mode-content {
      display: none;
    }

    .mode-content.active {
      display: block;
    }

    /* ===== GCP 미리보기 ===== */
    .image-preview-container {
      border: 2px dashed #bdc3c7;
      border-radius: 4px;
      min-height: 150px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 10px;
      background: #f8f9fa;
      overflow: hidden;
    }

    .image-preview-container canvas {
      display: block;
      max-width: 100%;
    }

    .image-preview-placeholder {
      color: #95a5a6;
      font-size: 13px;
      text-align: center;
      padding: 20px;
    }

    /* ===== GCP 테이블 ===== */
    #gcpTable {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
      margin-bottom: 10px;
    }

    #gcpTable th {
      background: #34495e;
      color: white;
      padding: 6px 4px;
      text-align: center;
      font-weight: 600;
    }

    #gcpTable td {
      padding: 5px 4px;
      text-align: center;
      border-bottom: 1px solid #ecf0f1;
    }

    #gcpTable tr:hover td {
      background: #f0f3f4;
    }

    #gcpTable .delete-btn {
      background: #e74c3c;
      color: white;
      border: none;
      border-radius: 3px;
      padding: 2px 8px;
      cursor: pointer;
      font-size: 11px;
    }

    #gcpTable .delete-btn:hover {
      background: #c0392b;
      transform: none;
    }

    .gcp-info {
      font-size: 12px;
      color: #7f8c8d;
      margin-bottom: 10px;
      text-align: center;
    }

    .gcp-status {
      font-size: 12px;
      font-weight: 600;
      text-align: center;
      padding: 6px;
      border-radius: 4px;
      margin-bottom: 10px;
    }

    .gcp-status.idle {
      color: #7f8c8d;
      background: #f0f3f4;
    }

    .gcp-status.awaiting-pixel {
      color: #2980b9;
      background: #d6eaf8;
    }

    .gcp-status.awaiting-map {
      color: #e67e22;
      background: #fdebd0;
    }

    .gcp-btn-group {
      display: flex;
      gap: 8px;
      margin-bottom: 10px;
    }

    .gcp-btn-group button {
      flex: 1;
      padding: 8px 10px;
      font-size: 13px;
    }
  </style>
</head>
<body>
  <div id="toolbar">
    <button id="drawLineBtn">선 그리기</button>
    <button id="drawPolygonBtn">다각형 그리기</button>
    <button id="editBtn">객체 편집</button>
    <div class="separator"></div>
    <button id="selectBtn">선택</button>
    <button id="rotateBtn">회전</button>
    <div class="separator"></div>
    <button id="imageOverlayBtn">이미지 오버레이</button>
    <button id="clearBtn">모두 지우기</button>
  </div>

  <!-- 이미지 오버레이 설정 패널 -->
  <div id="imagePanel" class="panel hidden">
    <h3>이미지 오버레이 설정</h3>

    <!-- 공통: 파일 선택 -->
    <div class="form-group">
      <label>이미지 파일 (PNG, JPG):</label>
      <input type="file" id="imageFile" accept="image/png,image/jpeg,image/jpg">
    </div>

    <!-- 탭 버튼 -->
    <div class="mode-tabs">
      <button id="extentModeTab" class="active" type="button">좌표 범위 모드</button>
      <button id="gcpModeTab" type="button">GCP 모드</button>
    </div>

    <!-- 좌표 범위 모드 -->
    <div id="extentModeContent" class="mode-content active">
      <div class="form-group">
        <label>좌표 범위 (경도/위도):</label>
        <button id="pickCoordBtn" class="secondary" type="button">
          지도에서 선택 (2번 클릭)
        </button>
        <div id="pickInstructions" class="instructions hidden">
          지도에서 2개 지점을 클릭하세요 (순서 무관)
        </div>
        <div class="coords-grid">
          <input type="number" id="minLon" placeholder="최소 경도" step="0.000001">
          <input type="number" id="minLat" placeholder="최소 위도" step="0.000001">
          <input type="number" id="maxLon" placeholder="최대 경도" step="0.000001">
          <input type="number" id="maxLat" placeholder="최대 위도" step="0.000001">
        </div>
      </div>
    </div>

    <!-- GCP 모드 -->
    <div id="gcpModeContent" class="mode-content">
      <!-- 이미지 미리보기 -->
      <div class="form-group">
        <label>이미지 미리보기:</label>
        <div class="image-preview-container">
          <canvas id="gcpPreviewCanvas" style="display:none;"></canvas>
          <div id="gcpPreviewPlaceholder" class="image-preview-placeholder">
            이미지 파일을 선택하면 미리보기가 표시됩니다.
          </div>
        </div>
      </div>

      <!-- 상태 표시 -->
      <div id="gcpStatus" class="gcp-status idle">대기 중</div>

      <!-- GCP 버튼 -->
      <div class="gcp-btn-group">
        <button id="addGCPBtn" class="secondary" type="button">GCP 추가</button>
        <button id="clearGCPBtn" class="danger" type="button">GCP 초기화</button>
      </div>

      <!-- GCP 목록 -->
      <div class="gcp-info">최소 3개의 GCP가 필요합니다.</div>
      <table id="gcpTable">
        <thead>
          <tr>
            <th>#</th>
            <th>픽셀 (x, y)</th>
            <th>경도, 위도</th>
            <th></th>
          </tr>
        </thead>
        <tbody id="gcpTableBody">
        </tbody>
      </table>
    </div>

    <!-- 공통: 투명도 + 버튼 -->
    <div class="form-group">
      <label>투명도: <span id="opacityValue">100%</span></label>
      <input type="range" id="opacitySlider" min="0" max="100" value="100">
    </div>

    <div class="button-group">
      <button id="applyImageBtn" class="primary">이미지 적용</button>
      <button id="clearImageBtn" class="danger">이미지 제거</button>
    </div>
  </div>

  <div id="map"></div>
  <script type="module" src="/src/main.ts"></script>
</body>
</html>
